<?xml version="1.0" encoding="UTF-8"?>
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://community.rti.com/schema/7.2.0/rti_routing_service.xsd" version="7.2.0">
    <types>
      <struct name="ServoControl" extensibility="appendable">
        <member name="pan" type="uint16"/>
        <member name="tilt" type="uint16"/>
        <member name="frequency" type="uint16"/>
      </struct>
      <const name="DEFAULT_CAM_CONTROL_TOPIC_NAME" type="string" value="pixy/servo_control"/>
      <enum name="ShapeFillKind">
        <enumerator name="SOLID_FILL" value="0"/>
        <enumerator name="TRANSPARENT_FILL" value="1"/>
        <enumerator name="HORIZONTAL_HATCH_FILL" value="2"/>
        <enumerator name="VERTICAL_HATCH_FILL" value="3"/>
      </enum>
      <struct name="ShapeType" extensibility="appendable">
        <member name="color" type="string" stringMaxLength="128" key="true"/>
        <member name="x" type="int32"/>
        <member name="y" type="int32"/>
        <member name="shapesize" type="int32"/>
      </struct>
      <struct name="ShapeTypeExtended" baseType="ShapeType">
        <member name="fillKind" type="nonBasic" nonBasicTypeName="ShapeFillKind"/>
        <member name="angle" type="float32"/>
      </struct>
      <const name="DEFAULT_CAM_CONFIG_TOPIC_NAME" type="string" value="pixy/camconfig"/>
      <struct name="PixyCamConfig">
        <!-- Which profiles are enabled -->
        <member name="profileEnabled" type="boolean" arrayDimensions="7"/>
      </struct>
      <struct name="TrackerHeartbeat" extensibility="appendable">
        <member name="MyHBwriterHandle" type="uint8" sequenceMaxLength="16" key="true"/>
      </struct>
      <struct name="VoteType" extensibility="appendable">
        <member name="SourceHBwriterHandle" type="uint8" sequenceMaxLength="16" key="true"/>
        <member name="NumberOfTrackers" type="int32"/>
        <member name="Primary" type="uint8" sequenceMaxLength="16"/>
        <member name="Secondary" type="uint8" sequenceMaxLength="16"/>
        <member name="Tertiary" type="uint8" sequenceMaxLength="16"/>
      </struct>
    </types>

    <qos_library name="PixyTrackerQOS_Library">
      <qos_profile name="PixyTracker_Profile">
        <domain_participant_qos>
          <transport_builtin>
            <mask>UDPv4</mask>
          </transport_builtin>
          <discovery>
            <initial_peers>
              <element>192.168.0.250</element>
              <element>4@builtin.udpv4://127.0.0.1</element>
              <element>builtin.shmem://</element>
            </initial_peers>
            <multicast_receive_addresses>
              <element>239.255.0.1</element>
            </multicast_receive_addresses>
          </discovery>
          <discovery_config>
            <endpoint_type_object_lb_serialization_threshold>-1</endpoint_type_object_lb_serialization_threshold>
          </discovery_config>
          <participant_name>
            <name>TrackerParticipant1</name>
            <!-- We can change this name w/o Code changes to see different participants in Admin Console -->
            <role_name>TrackerRole</role_name>
          </participant_name>
        </domain_participant_qos>
        <datareader_qos>
          <multicast>
            <value>
              <element>
                <receive_address>239.255.1.2</receive_address>
              </element>
            </value>
          </multicast>
          <subscription_name>
            <name>TrackerHostReader</name>
            <role_name>TrackerReader</role_name>
          </subscription_name>
        </datareader_qos>
        <datawriter_qos>
          <ownership>
            <kind>EXCLUSIVE_OWNERSHIP_QOS</kind>
          </ownership>
          <ownership_strength>
            <value>1</value>
          </ownership_strength>
          <publication_name>
            <name>TrackerHostWriter</name>
            <role_name>TrackerWriter</role_name>
          </publication_name>
        </datawriter_qos>
      </qos_profile>
      <qos_profile name="Exclusive">
        <datawriter_qos>
          <deadline>
            <!-- 100,000,000 ns = 100ms -->
            <period>
              <sec>0</sec>
              <nanosec>100000000</nanosec>
            </period>
          </deadline>
          <ownership>
            <kind>EXCLUSIVE_OWNERSHIP_QOS</kind>
          </ownership>
          <ownership_strength>
            <value>1</value>
          </ownership_strength>
        </datawriter_qos>
      </qos_profile>
      <qos_profile name="Durable">
        <datareader_qos>
          <durability>
            <kind>TRANSIENT_LOCAL_DURABILITY_QOS</kind>
          </durability>
          <reliability>
            <kind>RELIABLE_RELIABILITY_QOS</kind>
          </reliability>
        </datareader_qos>
        <datawriter_qos>
          <durability>
            <kind>TRANSIENT_LOCAL_DURABILITY_QOS</kind>
          </durability>
        </datawriter_qos>
      </qos_profile>
    </qos_library>

    <domain_library name="PixyShapesDomain_Library">
      <domain name="PixyShapesDomain" domain_id="53">
        <register_type name="ServoControl" type_ref="ServoControl"/>
        <register_type name="ShapeTypeExtended" type_ref="ShapeTypeExtended"/>
        <register_type name="TrackerHeartbeat" type_ref="TrackerHeartbeat"/>
        <register_type name="Vote" type_ref="VoteType"/>
        <topic name="Circle" register_type_ref="ShapeTypeExtended"/>
        <topic name="pixy/servo_control" register_type_ref="ServoControl"/>
        <topic name="tracker_heartbeat" register_type_ref="TrackerHeartbeat"/>
        <topic name="vote" register_type_ref="Vote"/>
      </domain>
    </domain_library>

    <domain_participant_library name="PixyTrackerParticipant_Library">
      <domain_participant name="PixyTrackerParticipant" domain_ref="PixyShapesDomain_Library::PixyShapesDomain">
        <publisher name="publisher">
          <data_writer name="servo_topic_writer" topic_ref="pixy/servo_control">
            <datawriter_qos base_name="PixyTrackerQOS_Library::Exclusive">
            </datawriter_qos>
          </data_writer>
          <data_writer name="tracker_hb_topic_writer" topic_ref="tracker_heartbeat"/>
          <data_writer name="vote_topic_writer" topic_ref="vote">
            <datawriter_qos base_name="PixyTrackerQOS_Library::Durable">
            </datawriter_qos>
          </data_writer>
        </publisher>
        <subscriber name="subscriber">
          <data_reader name="shape_topic_reader" topic_ref="Circle">
            <content_filter name="cft" kind="builtin.sql">
              <expression>color = &apos;RED&apos; AND shapesize &gt;70</expression>
            </content_filter>
            <datareader_qos>
              <time_based_filter>
                <minimum_separation>
                  <nanosec>5000000</nanosec>
                </minimum_separation>
              </time_based_filter>
            </datareader_qos>
          </data_reader>
          <data_reader name="tracker_hb_topic_reader" topic_ref="tracker_heartbeat"/>
          <data_reader name="vote_topic_reader" topic_ref="vote">
            <datareader_qos base_name="PixyTrackerQOS_Library::Durable">
            </datareader_qos>
          </data_reader>
        </subscriber>
        <domain_participant_qos base_name="PixyTrackerQOS_Library::PixyTracker_Profile">
        </domain_participant_qos>
      </domain_participant>
    </domain_participant_library>

</dds>
